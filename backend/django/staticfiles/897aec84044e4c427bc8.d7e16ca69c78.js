(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{442:function(t,e,o){"use strict";o.r(e);var n={data:function(){return{form:{comment:null,new:null,id:null},nameState:null,memo:{archived:null,commenting_required:null,created:null,date_sent:null,id:null,is_open:null,mem_priority:null,memo_type:null,message:null,receptors:[],recipients:[],reference_number:null,sender:{},sent:null,slug:null,subject:null,to:{}},extras:{can_comment:!1,can_close:!1}}},mounted:function(){var t=this;this.$axios.$get("/memos/"+this.$route.params.id+"/",{headers:this.$store.getters.authHeader}).then((function(e){t.memo=e.data,t.extras=e.extras})).catch((function(t){console.log(t)}))},methods:{editMemo:function(){return this.$router.push({path:"/memo/"+this.$route.params.id+"/edit"})},checkFormValidity:function(){var t=this.$refs.form.checkValidity();return this.nameState=t?"valid":"invalid",t},showModal:function(t){this.$refs.modal.show();var e=t.target.attributes["data-comment"].value;this.form.new=e,"old"===e?(this.form.id=t.target.attributes["data-comment-id"].value,this.form.comment=t.target.attributes["data-comment-text"].value):(this.form.id=null,this.form.comment=null)},handleOk:function(t){t.preventDefault(),this.handleSubmit()},handleSubmit:function(){var t=this;("new"===this.form.new?this.$axios.$post:this.$axios.$put)("memos/comments/",{new:this.form.new,comment:this.form.comment,memo_id:this.$route.params.id,comment_id:this.form.id},{headers:this.$store.getters.authHeader}).then((function(e){t.$nextTick((function(){t.$refs.modal.hide()})),window.location.reload()})).catch((function(t){console.log(t)}))},sendMemo:function(){this.$axios.$put("/memos/"+this.$route.params.id+"/",{send:!0},{headers:this.$store.getters.authHeader}).then((function(t){window.location.reload()})).catch((function(t){console.log(t)}))},closeMemo:function(){var t=this;this.$axios.$put("/memos/"+this.$route.params.id+"/",{close:!0},{headers:this.$store.getters.authHeader}).then((function(e){t.$router.push({path:"/memo/"+e.data.id})})).catch((function(t){console.log(t)}))}}},m=o(28),component=Object(m.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("article",[t.memo.sender.username===t.$store.getters.loggedInUser&&t.memo.is_open&&t.extras.can_edit_memo?o("button",{staticClass:"btn btn-warning mb-2",on:{click:t.editMemo}},[t._v("EDIT")]):t._e(),t._v(" "),t.memo.sent||t.memo.sender.username!==t.$store.getters.loggedInUser?t._e():o("button",{staticClass:"btn btn-success mb-2",on:{click:t.sendMemo}},[t._v("SEND")]),t._v(" "),t.extras.can_close&&t.memo.to.username===t.$store.getters.loggedInUser?o("button",{staticClass:"btn btn-danger mb-2",on:{click:t.closeMemo}},[t._v("CLOSE")]):t._e(),t._v(" "),o("b-card",{staticClass:"memo mb-5",attrs:{variant:"bg-light"}},[o("b-row",[o("b-col",{attrs:{cols:"2"}},[t._v("FROM:")]),t._v(" "),o("b-col",{staticClass:"d-flex justify-content-between"},[o("span",[t._v("\n                    "+t._s(t.memo.sender.get_full_name||t.memo.sender.username)+"\n                ")]),t._v(" "),o("span",[t._v("\n                    TO: "+t._s(t.memo.to.get_full_name||t.memo.to.username)+"\n                ")]),t._v(" "),o("span",[t._v("\n                    "+t._s(t.memo.date_sent)+"\n                ")])])],1),t._v(" "),o("b-row",[o("b-col",{attrs:{cols:"2"}},[t._v("RECIPIENTS:")]),t._v(" "),o("b-col",t._l(t.memo.recipients,(function(e){return o("span",{key:e.id,staticClass:"mr-2"},[t._v("@"+t._s(e.username)+" ")])})),0)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{cols:"2"}},[t._v("SUBJECT:")]),t._v(" "),o("b-col",{staticClass:"font-weight-bold text-uppercase"},[t._v(t._s(t.memo.subject))])],1),t._v(" "),o("b-row",[o("b-col",{attrs:{cols:"2"}},[t._v("REFERENCE:")]),t._v(" "),o("b-col",{staticClass:"font-italic font-weight-light"},[t._v(t._s(t.memo.reference_number))])],1),t._v(" "),o("b-row",[o("b-col",{staticClass:"bg-dark mx-0 my-2 p-1",attrs:{cols:"12"}},[o("h5",{staticClass:"h5 ml-2 mb-0 text-white"},[t._v("BODY:")])]),t._v(" "),o("b-col",{attrs:{cols:"12"}},[o("b-card-text",{domProps:{innerHTML:t._s(t.memo.message)}})],1)],1),t._v(" "),o("b-row",[o("b-col",{staticClass:"bg-dark mx-0 my-2 p-1",attrs:{cols:"12"}},[o("h5",{staticClass:"h5 ml-2 mb-0 text-white"},[t._v("\n                    COMMENTS: "+t._s(t.memo.comment_count)+" \n                    "),t.extras.can_comment?o("b-button",{staticClass:"float-right btn-sm",attrs:{id:"show-btn","data-comment":"new"},on:{click:t.showModal}},[t._v("New Comment")]):t._e()],1)]),t._v(" "),o("ul",{staticClass:"list-unstyled mt-2 mb-0"},t._l(t.memo.memocomment_comment,(function(e){return o("b-media",{key:e.id,staticClass:"mb-4",attrs:{tag:"li"},scopedSlots:t._u([{key:"aside",fn:function(){return[o("b-img",{staticClass:"rounded-circle",attrs:{blank:"","blank-color":"#abc",width:"50",alt:"placeholder"}})]},proxy:!0}],null,!0)},[t._v(" "),o("h5",{staticClass:"h6 mt-0 mb-1 font-weight-light"},[t._v(t._s(e.commenter.get_full_name)+" | "+t._s(t._f("date")(e.timestamp))+"\n                        "),e.commenter.username===t.$store.getters.loggedInUser&&t.extras.can_edit_comment?o("span",{staticClass:"ml-5 text-small",attrs:{"data-comment":"old","data-comment-id":e.id,"data-comment-text":e.comment},on:{click:t.showModal}},[t._v("Edit")]):t._e()]),t._v(" "),o("p",{staticClass:"mb-0"},[t._v("\n                        "+t._s(e.comment)+"\n                    ")])])})),1)],1)],1),t._v(" "),t.memo.sent||t.memo.sender.username!==t.$store.getters.loggedInUser?t._e():o("button",{staticClass:"btn btn-success mb-2",on:{click:t.sendMemo}},[t._v("SEND")]),t._v(" "),t.extras.can_close&&t.memo.to.username===t.$store.getters.loggedInUser?o("button",{staticClass:"btn btn-danger mb-2",on:{click:t.closeMemo}},[t._v("CLOSE")]):t._e(),t._v(" "),o("b-modal",{ref:"modal",attrs:{title:"Comment",size:"lg",centered:""},on:{ok:t.handleOk}},[o("b-form",{ref:"form",on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit(e)}}},[o("b-row",[o("b-col",[o("b-form-group",{attrs:{id:"fieldset-horizontal",state:t.nameState,"label-cols-sm":"3","label-cols-lg":"2","label-size":"sm",description:"Comment",label:"Comment","label-for":"comment","invalid-feedback":"comment is required"}},[o("b-form-textarea",{attrs:{id:"comment",state:t.nameState,required:""},model:{value:t.form.comment,callback:function(e){t.$set(t.form,"comment",e)},expression:"form.comment"}})],1)],1)],1),t._v(" "),t._t("default")],2)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);